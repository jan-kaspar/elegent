#!/bin/bash

html_file="index.html"
distribution_dir="../distributions"

#----------------------------------------------------------------------------------------------------

function InitHtml()
{
	(
		echo "<html>"
		echo "    <head>"
		echo "    </head>"
		echo "<body>"
	) > "$html_file"
}

#----------------------------------------------------------------------------------------------------

function FinishHtml()
{
	(
		echo "</body>"
		echo "</html>"
	) >> "$html_file"
}

#----------------------------------------------------------------------------------------------------

function GeneratePlots()
{
	local mode="$1"
	local energy="$2"
	local tag="$1,${2}GeV"

	echo ">> $tag"

	mkdir -p "$tag"

	cat "template.asy" | sed "\
			s|\$mode|$mode|;\
			s|\$energy|$energy|;\
			s|\$input_dir|../$distribution_dir|;\
			s|\$input_tag|$tag|;\
		" > "$tag/build_plots.asy"

	cd "$tag" || return

	asy "build_plots.asy"

	# include html file generated by Asymptote
	cat "include.html" >> "../index.html"

	# clean
	#rm "build_plots.asy"
	#rm "include.html"

	cd - > /dev/null
}

#----------------------------------------------------------------------------------------------------

InitHtml
GeneratePlots "pp" "2760"
GeneratePlots "pp" "7000"
GeneratePlots "pp" "8000"
GeneratePlots "pp" "13000"
GeneratePlots "pp" "14000"
FinishHtml
